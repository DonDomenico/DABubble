<section>
  <div class="chat-header">
    <div class="dev-team-container" (click)="updateChannel(channelService.channelId)">
      <p># {{ getSingleChannel()?.name }}</p>
      <mat-icon>keyboard_arrow_down</mat-icon>
    </div>

    <div class="add-member-container">
      <div class="avatar-container">
        @for (item of channelService.memberInfos; track $index) {

        <img src="{{ item['photoURL'] }}" class="avarar-icon" matTooltip="{{ item['username'] }}"
          [matTooltipPosition]="'below'" (click)="showMembersDialog()" />
        }
        <p>{{ channelService.channelMembers.length }}</p>
      </div>

      <span class="material-symbols-outlined" (click)="addMemberDialog()">
        <mat-icon>person_add</mat-icon>
      </span>
    </div>
  </div>

  @if (dataLoaded) {
  <div #messagesContainer class="messages-container">
    @for (message of channelService.messages; track $index ) {
    <div class="divider">
      <hr class="line" />

      @if(isDifferentDay($index)) {
      <span class="date">{{ message.timestamp | date }}</span>
      }

      <hr class="line" />
    </div>

    <div class="message-wrapper">
      <div class="single-message-container">
        <img src="{{ message.userAvatar }}" class="member-avatar" />
        <div class="message-content">
          <div class="name-time">
            <span>{{ message.userName }}</span>
            <p>{{ message.timestamp | date : "HH:mm" : "CET" }}</p>
          </div>

          <span class="user-message">
            {{ message.userMessage }}
          </span>

          <div class="reactions">
            <div class="answers">
              @if (message.answers && message.answers.length > 0) {
                <span class="answers-link" [routerLink]="['single-channel/' + channelService.channelId + '/thread/' + message.docId]" (click)="channelService.showThread(); toggleMessageBoxSize(messageBoxContainer)">{{ message.answers.length }} Antwort(en)</span>
              }
              <span [routerLink]="['single-channel/' + channelService.channelId + '/thread/' + message.docId]"
                (click)="channelService.showThread(); toggleMessageBoxSize(messageBoxContainer)">
                <mat-icon>comment</mat-icon>
              </span>
            </div>

            <div class="show-emoji-reactions">
              @if (message.emojiReactions.length > 0) {
                @for (emoji of message.emojiReactions; track $index) {
                <div class="emoji-reaction" matTooltip="{{ emoji.users.join(', ') }}">{{ emoji.emoji + emoji.counter }}</div>
                }
              }

              <div class="add-emoji-container" #emojiPickerReaction (click)="onClickInside($event)">
                <button class="emoji-button" (click)="toggleEmojiPickerReaction(message.docId!)"><img src="./assets/img/add_reaction.svg"></button>
                <emoji-mart class="emoji-mart reaction-emojis" set="twitter" *ngIf="showEmojiPickerReaction.get(message.docId!)"
                  (emojiSelect)="addEmojiReaction($event, message.docId!)" title="Pick your emoji…"></emoji-mart>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
  }

  <div class="message-box-wrapper">
    <div class="message-box-container" #messageBoxContainer>
      <textarea name="message" placeholder="Nachricht an {{ getSingleChannel()?.name }}" [(ngModel)]="message"
        (ngModelChange)="hideErrorMessage()"></textarea>

      <div class="message-box">
        <div class="message-box-icons">
          <div class="add-emoji-container" #emojiPicker (click)="onClickInside($event)">
            <button class="emoji-button" (click)="toggleEmojiPicker()"><img src="./assets/img/add_reaction.svg"></button>
            <emoji-mart class="emoji-mart message-emojis" set="twitter" *ngIf="showEmojiPicker"
              (emojiSelect)="addEmoji($event)" title="Pick your emoji…"></emoji-mart>
          </div>
          <mat-icon>alternate_email</mat-icon>
        </div>
        <mat-icon class="send-icon" (click)="addMessage()">send</mat-icon>
      </div>
    </div>
    <div class="error-container-message">
      @if(messageEmpty) {
      <span class="error-message-empty">Bitte gib eine Nachricht ein.</span>
      }
    </div>
  </div>
</section>