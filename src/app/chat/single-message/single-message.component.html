<section id="messages-container" #messagesContainer>
  <div class="chat-header">
    <div class="hearder-content" (click)="showProfileDialog(userId)">
      @if(user) {
      <img src="{{ user.photoURL }}"/>
      <span class="active-status" [ngStyle]="user.active ? {backgroundColor: '#92C83E'} : {backgroundColor: '#686868'}"></span>
      <p>{{ user.username }}</p>
      } @else if(authService.currentUser) {
      <img src="{{ authService.currentUser.photoURL }}" />
      <span class="active-status" [ngStyle]="authService.currentUser !== null ? {backgroundColor: '#92C83E'} : {backgroundColor: '#686868'}"></span>
      <p>{{ authService.currentUser.displayName }} (Du)</p>
      }
    </div>
  </div>


  @if (dataLoaded) {
    @for (message of conversationMessages; track $index ) {
    <div class="message-wrapper">
      <div class="divider">
        <hr class="line" />
        @if(isDifferentDay($index)) {
        <span class="date">{{ message.timestamp | date }}</span>
        }
        <hr class="line" />
      </div>

      <div class="message-content"
        [ngStyle]="{'flex-direction': authService.currentUser.displayName === message.initiatedBy ? 'row-reverse' : 'row'}">
        <div class="single-message-container"
          [ngStyle]="{'flex-direction': authService.currentUser.displayName === message.initiatedBy ? 'row-reverse' : 'row'}">
          <img src="{{ message.senderAvatar }}" class="member-avatar" />
          <div class="message-content">
            <div class="name-time"
              [ngStyle]="{'justify-content': authService.currentUser.displayName === message.initiatedBy ? 'flex-end' : 'flex-start'}">
              <span>{{ message.initiatedBy }}</span>
              <p>{{ message.timestamp | date:'HH:mm':'CET' }}</p>
            </div>

            <span class="user-message"
              [ngStyle]="authService.currentUser.displayName === message.initiatedBy ? {'text-align': 'end', 'border-radius': '30px 0 30px 30px'} : {}">
              {{ message.senderMessage }}

            </span>
          </div>
        </div>
      </div>
    </div>
    }
  }


  <div class="input-wrapper">
    <div class="message-owner-container" (click)="showProfileDialog(userId)">
      <!-- <div class="message-owner-content">

        @if(user) {
        <img src="{{ user.photoURL }}" />
        <p>{{ user.username }}</p>
        }
      </div> -->

      @if(!isCurrentUser && user) {
      <p>
        Diese Unterhaltung findet nur zwischen

        <span (click)="showProfileDialog(userId)">&#64; {{ user.username }}</span>
        und dir statt.
      </p>
      } @if (isCurrentUser) {
      <p>
        Dieser Raum ist nur fÃ¼r dich da. Mache dir Notizen, liste deine To-dos auf
        oder bewahre Links und Dateien griffbereit auf. Du kannst hier auch gerne
        Dinge mit dir selbst besprechen.
      </p>
      }
    </div>

    <div class="message-box-container">
      @if(conversationMessages && user) {
      <textarea id="inputfield" autofocus name="message" placeholder="Nachricht an {{ user.username }}" #input
        [(ngModel)]="conversationMessage"></textarea>
      }
      <div class="message-box">
        <div class="message-box-icons">
          <button class="emoji-button" (click)="toggleEmojiPicker()">ğŸ˜€</button>
          <emoji-mart class="emoji-mart" set="twitter" *ngIf="showEmojiPicker" (emojiSelect)="addEmoji($event)" title="Pick your emojiâ€¦"></emoji-mart>
          <mat-icon>alternate_email</mat-icon>
        </div>
        <mat-icon class="send-icon" (click)="createConversation()">send</mat-icon>
      </div>
    </div>
    <div class="error-container-message">
      @if(messageEmpty) {
      <span class="error-message-empty">Bitte gib eine Nachricht ein.</span>
      }
    </div>
  </div>
</section>